<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Monarch-Lite v9</title>
    <style>
        :root { --m-blue: #0a192f; --m-teal: #17e9e1; --m-bg: #121212; --m-card: #1e1e1e; --m-red: #ff5252; --m-green: #2ecc71; --m-text: #ffffff; }
        body { font-family: 'Inter', sans-serif; background: var(--m-bg); margin: 0; padding: 10px; color: var(--m-text); padding-bottom: 80px; }
        
        .budget-header { background: var(--m-green); color: white; padding: 15px; border-radius: 12px; margin-bottom: 12px; }
        .header-main { display: flex; justify-content: space-between; font-weight: 800; font-size: 1.1rem; }
        .header-sub { font-size: 11px; opacity: 0.9; margin-top: 4px; }

        .card { background: var(--m-card); padding: 15px; border-radius: 16px; margin-bottom: 15px; }
        .net-worth-h1 { font-size: 2.2rem; margin: 8px 0; font-weight: 700; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        small { font-size: 10px; opacity: 0.6; text-transform: uppercase; font-weight: bold; }
        .val { font-size: 18px; font-weight: 600; }
        
        .bar-bg { background: #333; height: 8px; border-radius: 4px; overflow: hidden; margin: 10px 0;}
        .bar-fill { height: 100%; transition: width 0.5s ease; }
        
        input, select { width: 100%; padding: 12px; margin: 5px 0; border: 1px solid #333; background: #2a2a2a; color: white; border-radius: 8px; font-size: 14px; box-sizing: border-box; }
        .btn-add { background: #333; color: var(--m-teal); border: 1px dashed var(--m-teal); padding: 8px; border-radius: 8px; width: 100%; font-size: 11px; font-weight: bold; cursor: pointer; }
        
        .plan-item { padding: 8px 0; border-bottom: 1px solid #2a2a2a; }
        .plan-row-top { display: flex; justify-content: space-between; font-size: 13px; font-weight: 600; }
        
        .btn-track { width: 100%; padding: 16px; background: var(--m-teal); color: var(--m-blue); border-radius: 12px; border: none; font-weight: 800; text-transform: uppercase; margin-top: 10px; cursor: pointer; }
        
        /* Transaction & Cash Flow Styles */
        .txn-row { display: flex; align-items: center; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #2a2a2a; }
        .txn-icon { width: 32px; height: 32px; background: #2a2a2a; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 10px; font-size: 16px; }
        .del-btn { color: var(--m-red); background: none; border: none; font-size: 18px; cursor: pointer; }
        
        .flow-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #2a2a2a; }
        .flow-bar-container { flex-grow: 1; margin: 0 15px; background: #333; height: 6px; border-radius: 3px; position: relative; }
        .flow-bar-fill { height: 100%; background: var(--m-teal); border-radius: 3px; }
    </style>
</head>
<body>

    <div id="header-container" class="budget-header">
        <div class="header-main">
            <span>Remaining to Spend</span>
            <span id="left-val">$0</span>
        </div>
        <div class="header-sub" id="left-desc">Based on $0 planned expenses</div>
    </div>

    <div class="card">
        <small>Current Net Worth</small>
        <div class="net-worth-h1" id="net-val">$0.00</div>
        <div class="grid">
            <div><small>Actual Inc</small><span id="act-inc" class="val" style="color:var(--m-teal)">$0</span></div>
            <div><small>Actual Exp</small><span id="act-exp" class="val">$0</span></div>
        </div>
    </div>

    <div class="card">
        <div style="display:flex; justify-content:space-between">
            <b style="color:var(--m-teal)">Monthly Plan</b>
            <small id="plan-pct">0% Spent</small>
        </div>
        <div class="bar-bg"><div id="budget-bar" class="bar-fill"></div></div>
        <div class="grid">
            <div>
                <small>Expected Inc: <span id="total-p-inc">$0</span></small>
                <div id="plan-inc-list"></div>
                <button class="btn-add" onclick="promptPlan('inc')">+ Add Income</button>
            </div>
            <div>
                <small>Expected Exp: <span id="total-p-exp">$0</span></small>
                <div id="plan-exp-list"></div>
                <button class="btn-add" onclick="promptPlan('exp')">+ Add Expense</button>
            </div>
        </div>
    </div>

    <div class="card">
        <b>Track Transaction</b>
        <input type="text" id="desc" placeholder="Merchant (e.g. Rogers)">
        <select id="cat">
            <option value="ðŸ’°">Income / Paycheck</option>
            <option value="ðŸ ">Housing & Bills</option>
            <option value="ðŸ›’">Groceries</option>
            <option value="ðŸ³">Dining & Food</option>
            <option value="ðŸ‹ï¸">Gym & Snacks</option>
            <option value="ðŸš—">Transport</option>
            <option value="ðŸ’Š">Medical</option>
        </select>
        <div class="grid" style="grid-template-columns: 1fr 1fr;">
            <input type="date" id="txn-date">
            <input type="text" inputmode="decimal" id="amt" placeholder="Amount (neg for exp)">
        </div>
        <button class="btn-track" onclick="addTransaction()">Add Entry</button>
    </div>

    <h3 style="margin-left:10px;">Cash Flow by Category</h3>
    <div class="card" id="cash-flow-list"></div>

    <h3 style="margin-left:10px;">Transactions</h3>
    <div class="card" id="txn-list"></div>

    <script>
        let txns = JSON.parse(localStorage.getItem('m9_txns')) || [];
        let planInc = JSON.parse(localStorage.getItem('m9_p_inc')) || [];
        let planExp = JSON.parse(localStorage.getItem('m9_p_exp')) || [];

        document.getElementById('txn-date').valueAsDate = new Date();

        function promptPlan(type) {
            const name = prompt("Enter name:");
            const amt = parseFloat(prompt("Enter amount:"));
            if (!name || isNaN(amt)) return;
            const list = type === 'inc' ? planInc : planExp;
            list.push({ id: Date.now(), name, amt });
            saveAndRefresh();
        }

        function deletePlan(type, id) {
            if (type === 'inc') planInc = planInc.filter(i => i.id !== id);
            else planExp = planExp.filter(i => i.id !== id);
            saveAndRefresh();
        }

        function saveAndRefresh() {
            localStorage.setItem('m9_p_inc', JSON.stringify(planInc));
            localStorage.setItem('m9_p_exp', JSON.stringify(planExp));
            updateUI();
        }

        function addTransaction() {
            const desc = document.getElementById('desc').value;
            const cat = document.getElementById('cat').value;
            const date = document.getElementById('txn-date').value;
            const amt = parseFloat(document.getElementById('amt').value);
            if(!desc || !date || isNaN(amt)) return;

            txns.unshift({ id: Date.now(), desc, cat, date, amt });
            document.getElementById('desc').value = '';
            document.getElementById('amt').value = '';
            updateUI();
        }

        function deleteTxn(id) {
            txns = txns.filter(t => t.id !== id);
            updateUI();
        }

        function updateUI() {
            const incListEl = document.getElementById('plan-inc-list');
            const expListEl = document.getElementById('plan-exp-list');
            const flowListEl = document.getElementById('cash-flow-list');
            const txnListEl = document.getElementById('txn-list');
            
            incListEl.innerHTML = ''; expListEl.innerHTML = ''; flowListEl.innerHTML = ''; txnListEl.innerHTML = '';
            
            let sumPInc = 0, sumPExp = 0, aInc = 0, aExp = 0;
            let catTotals = {};

            // Process Transactions
            txns.sort((a, b) => new Date(b.date) - new Date(a.date));
            txns.forEach(t => {
                if (t.amt > 0) aInc += t.amt; else aExp += Math.abs(t.amt);
                
                // Track category totals for Cash Flow
                catTotals[t.cat] = (catTotals[t.cat] || 0) + Math.abs(t.amt);

                const d = new Date(t.date + 'T00:00:00').toLocaleDateString(undefined, { month: 'short', day: 'numeric' });
                txnListEl.innerHTML += `<div class="txn-row"><div class="txn-icon">${t.cat}</div><div style="flex-grow:1"><div style="font-weight:600; font-size:14px;">${t.desc}</div><small>${d}</small></div><div style="text-align:right"><span class="val" style="font-size:14px; color:${t.amt > 0 ? 'var(--m-green)' : '#fff'}">${t.amt > 0 ? '+' : '-'}$${Math.abs(t.amt).toFixed(2)}</span></div><button class="del-btn" style="margin-left:10px" onclick="deleteTxn(${t.id})">Ã—</button></div>`;
            });

            // Update Cash Flow UI
            Object.keys(catTotals).forEach(cat => {
                const total = catTotals[cat];
                const pct = aExp > 0 ? (total / aExp) * 100 : 0;
                flowListEl.innerHTML += `
                    <div class="flow-row">
                        <div style="width:30px">${cat}</div>
                        <div class="flow-bar-container"><div class="flow-bar-fill" style="width:${pct}%"></div></div>
                        <div style="text-align:right; font-size:12px; font-weight:600;">$${total.toFixed(0)} <small>(${pct.toFixed(0)}%)</small></div>
                    </div>`;
            });

            // Display Plans
            planInc.forEach(i => { sumPInc += i.amt; incListEl.innerHTML += `<div class="plan-item"><div class="plan-row-top"><span>${i.name}</span><span>$${i.amt}</span></div><button class="del-btn" style="font-size:10px" onclick="deletePlan('inc', ${i.id})">Remove</button></div>`; });
            planExp.forEach(i => { sumPExp += i.amt; expListEl.innerHTML += `<div class="plan-item"><div class="plan-row-top"><span>${i.name}</span><span>$${i.amt}</span></div><button class="del-btn" style="font-size:10px" onclick="deletePlan('exp', ${i.id})">Remove</button></div>`; });

            // Summary Math
            const net = aInc - aExp;
            const remainingToSpend = sumPExp - aExp;
            const pctSpent = sumPExp > 0 ? (aExp / sumPExp) * 100 : 0;

            document.getElementById('total-p-inc').innerText = `$${sumPInc}`;
            document.getElementById('total-p-exp').innerText = `$${sumPExp}`;
            document.getElementById('net-val').innerText = (net < 0 ? '-$' : '$') + Math.abs(net).toLocaleString(undefined, {minimumFractionDigits: 2});
            document.getElementById('act-inc').innerText = `$${aInc.toLocaleString()}`;
            document.getElementById('act-exp').innerText = `$${aExp.toLocaleString()}`;
            document.getElementById('left-val').innerText = `$${remainingToSpend.toLocaleString()}`;
            document.getElementById('left-desc').innerText = `Spent $${aExp.toLocaleString()} of $${sumPExp.toLocaleString()} budget.`;
            document.getElementById('header-container').style.background = remainingToSpend < 0 ? 'var(--m-red)' : 'var(--m-green)';
            document.getElementById('plan-pct').innerText = `${pctSpent.toFixed(0)}% Spent`;
            document.getElementById('budget-bar').style.width = Math.min(pctSpent, 100) + '%';
            document.getElementById('budget-bar').style.background = pctSpent > 100 ? 'var(--m-red)' : 'var(--m-teal)';

            localStorage.setItem('m9_txns', JSON.stringify(txns));
        }
        updateUI();
    </script>
</body>
</html>
