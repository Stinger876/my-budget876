<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Monarch-Lite v20.10</title>

<style>
:root {
    --m-blue:#0a192f;
    --m-teal:#17e9e1;
    --m-bg:#121212;
    --m-card:#1e1e1e;
    --m-red:#ff5252;
    --m-green:#2ecc71;
    --m-header-green:#1b4d3e;
    --m-orange:#ff9f43;
    --m-text:#ffffff;
}
body {
    font-family:Inter, sans-serif;
    background:var(--m-bg);
    color:var(--m-text);
    margin:0;
    padding:10px;
    padding-bottom:80px;
}
.budget-header {
    padding:20px;
    border-radius:16px;
    margin-bottom:12px;
    text-align:center;
    position:relative;
    min-height:100px;
}
.bg-spending { background:var(--m-header-green); border:1px solid var(--m-green); }
.bg-invest { background:var(--m-blue); border:1px solid var(--m-teal); }
.bg-liab { background:#3d2b1f; border:1px solid var(--m-orange); }

.header-meta {
    font-size:10px;
    opacity:.7;
    display:flex;
    justify-content:space-between;
    position:absolute;
    top:10px; left:20px; right:20px;
    font-family:monospace;
}
.header-main { font-size:1.4rem; font-weight:800; margin-top:20px; }

.tab-bar { display:flex; gap:5px; margin-bottom:15px; }
.tab {
    flex:1; padding:12px; border-radius:10px;
    background:#222; color:white; font-weight:bold;
    border:none; opacity:.6;
}
.tab.active { background:var(--m-teal); color:var(--m-blue); opacity:1; }

.card {
    background:var(--m-card);
    padding:15px;
    border-radius:16px;
    margin-bottom:15px;
}

.cf-row, .budget-row {
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:10px 0;
    border-bottom:1px solid #2a2a2a;
    font-size:14px;
}
.budget-row input { width:80px; }

input, select {
    width:100%;
    padding:10px;
    background:#2a2a2a;
    border:1px solid #333;
    color:white;
    border-radius:8px;
}

.btn-track {
    width:100%;
    padding:16px;
    margin-top:10px;
    background:var(--m-teal);
    color:var(--m-blue);
    border:none;
    border-radius:12px;
    font-weight:800;
}

.btn-mgmt {
    flex:1;
    background:#333;
    border:1px solid #555;
    padding:12px;
    border-radius:12px;
    color:white;
    font-weight:bold;
}

.btn-danger {
    width:100%;
    background:#3d1010;
    color:var(--m-red);
    border:1px solid var(--m-red);
    padding:16px;
    border-radius:12px;
    font-weight:800;
}

@keyframes pulse {
    0%{box-shadow:0 0 0 rgba(23,233,225,0)}
    50%{box-shadow:0 0 15px rgba(23,233,225,.6)}
    100%{box-shadow:0 0 0 rgba(23,233,225,0)}
}
.pulse { animation:pulse 2s infinite; }

.pos{color:var(--m-green)}
.neg{color:var(--m-red)}
</style>
</head>

<body>

<div class="budget-header bg-spending" id="main-header">
    <div class="header-meta">
        <span id="meta-file"></span>
        <span id="meta-saved"></span>
    </div>
    <div id="header-content"></div>
</div>

<select id="month-filter" onchange="updateUI()">
    <option value="01">January</option><option value="02">February</option>
    <option value="03">March</option><option value="04">April</option>
    <option value="05">May</option><option value="06">June</option>
    <option value="07">July</option><option value="08">August</option>
    <option value="09">September</option><option value="10">October</option>
    <option value="11">November</option><option value="12">December</option>
</select>

<div class="tab-bar">
    <button class="tab active" onclick="switchTab('budget')">Budget</button>
    <button class="tab" onclick="switchTab('invest')">Investments</button>
    <button class="tab" onclick="switchTab('liab')">Liabilities</button>
</div>

<div id="view-budget">
    <div class="card">
        <b>Income</b>
        <div id="income-list"></div>
    </div>

    <div class="card">
        <b>Expenses</b>
        <div id="expense-list"></div>
    </div>

    <div class="card">
        <b>Add Transaction</b>
        <input id="desc" placeholder="Description">
        <select id="cat-select"></select>
        <div style="display:flex; gap:10px;">
            <input type="date" id="txn-date">
            <input id="amt" type="number" placeholder="Amount">
        </div>
        <button class="btn-track" onclick="addTransaction()">Track</button>
    </div>

    <div id="txn-list"></div>
</div>

<div id="view-invest" style="display:none">
    <div class="card" id="invest-main-list"></div>
</div>

<div id="view-liab" style="display:none">
    <div class="card" id="liab-main-list"></div>
</div>

<div class="card">
    <button id="save-btn" class="btn-mgmt" onclick="exportToFile()">ðŸ’¾ Save</button>
</div>

<button class="btn-danger" onclick="clearAllData()">Reset All</button>

<script>
let txns = JSON.parse(localStorage.getItem('m_txns')) || [];
let planInc = JSON.parse(localStorage.getItem('m_p_inc')) || [];
let planExp = JSON.parse(localStorage.getItem('m_p_exp')) || [];
let assets = JSON.parse(localStorage.getItem('m_assets')) || [];
let liabs = JSON.parse(localStorage.getItem('m_liabs')) || [];
let curFile = localStorage.getItem('m_cur_file') || 'Browser Storage';
let activeTab='budget';

window.onload=()=>{
    const d=new Date();
    month-filter.value=String(d.getMonth()+1).padStart(2,'0');
    txn-date.valueAsDate=d;
    updateUI();
};

function pulseSaveOnce(){
    save-btn.classList.add('pulse');
    setTimeout(()=>save-btn.classList.remove('pulse'),3000);
}

function saveInternal(update=true){
    localStorage.setItem('m_txns',JSON.stringify(txns));
    localStorage.setItem('m_p_inc',JSON.stringify(planInc));
    localStorage.setItem('m_p_exp',JSON.stringify(planExp));
    localStorage.setItem('m_assets',JSON.stringify(assets));
    localStorage.setItem('m_liabs',JSON.stringify(liabs));
    localStorage.setItem('m_cur_file',curFile);
    pulseSaveOnce();
    if(update) updateUI();
}

function updateUI(){
    income-list.innerHTML='';
    expense-list.innerHTML='';
    txn-list.innerHTML='';
    cat-select.innerHTML='';
    invest-main-list.innerHTML='';
    liab-main-list.innerHTML='';

    meta-file.innerText=`File: ${curFile}`;
    meta-saved.innerText=`Saved: ${new Date().toLocaleTimeString()}`;

    const month=month-filter.value;
    const year=new Date().getFullYear();

    const monthTxns=txns.filter(t=>{
        if(!t.date) return false;
        const [y,m]=t.date.split('-');
        return m===month && Number(y)===year;
    });

    let spent=0;
    monthTxns.forEach(t=>{ if(t.amt<0) spent+=Math.abs(t.amt) });

    header-content.innerHTML=`<div class="header-main">$${spent.toLocaleString()} spent</div>`;

    planInc.forEach((p,i)=>{
        const total=monthTxns.filter(t=>t.cat===p.name).reduce((s,t)=>s+t.amt,0);
        const diff=total-p.amt;
        income-list.innerHTML+=`
        <div class="budget-row">
            <span>${p.name}</span>
            <input value="${p.amt}" onchange="planInc[${i}].amt=+this.value||0;saveInternal(false)">
            <span class="${diff>=0?'pos':'neg'}">${diff>=0?'+':''}$${Math.abs(diff).toLocaleString()}</span>
        </div>`;
        cat-select.innerHTML+=`<option>${p.name}</option>`;
    });

    planExp.forEach((p,i)=>{
        const total=monthTxns.filter(t=>t.cat===p.name).reduce((s,t)=>s+Math.abs(t.amt),0);
        expense-list.innerHTML+=`
        <div class="budget-row">
            <span>${p.name}</span>
            <input value="${p.amt}" onchange="planExp[${i}].amt=+this.value||0;saveInternal(false)">
            <span>$${(p.amt-total).toLocaleString()}</span>
        </div>`;
        cat-select.innerHTML+=`<option>${p.name}</option>`;
    });

    monthTxns.forEach(t=>{
        const idx=txns.findIndex(x=>x.id===t.id);
        txn-list.innerHTML+=`
        <div class="card" style="display:flex;justify-content:space-between;">
            <span>${t.cat} â€“ ${t.desc}</span>
            <span class="${t.amt<0?'neg':'pos'}">$${Math.abs(t.amt).toFixed(2)}
            <button onclick="deleteTxn(${idx})">âœ•</button></span>
        </div>`;
    });
}

function addTransaction(){
    if(!desc.value || !amt.value) return;
    const isInc=planInc.some(p=>p.name===cat-select.value);
    txns.unshift({
        id: crypto.randomUUID(),
        desc:desc.value,
        cat:cat-select.value,
        date:txn-date.value,
        amt:isInc?Math.abs(+amt.value):-Math.abs(+amt.value)
    });
    desc.value=''; amt.value='';
    saveInternal();
}

function deleteTxn(i){
    if(i<0||i>=txns.length) return;
    txns.splice(i,1);
    saveInternal();
}

function switchTab(t){
    activeTab=t;
    view-budget.style.display=t==='budget'?'block':'none';
    view-invest.style.display=t==='invest'?'block':'none';
    view-liab.style.display=t==='liab'?'block':'none';
}

function exportToFile(){
    const blob=new Blob([JSON.stringify({txns,planInc,planExp,assets,liabs})]);
    const a=document.createElement('a');
    a.href=URL.createObjectURL(blob);
    a.download=`monarch_backup_${Date.now()}.json`;
    a.click();
}

function clearAllData(){
    if(confirm("Reset everything?")){
        localStorage.clear();
        location.reload();
    }
}
</script>

</body>
</html>
